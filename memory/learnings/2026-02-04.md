# Learnings: 2026-02-04

## Major Mistake: Wrong Workflow for Coding Tasks

### What I Did Wrong
When asked to fix the zone pinning bug, I:
1. Created a worktree WITHOUT specifying boardId → orphaned worktree (invisible on board)
2. Used `sessions.spawn` instead of `sessions.create` → created subsession in SAME worktree
3. Led to cascade of nested subsessions with callback chaos

### Root Cause
- **Optional boardId confused me**: Should be REQUIRED to prevent orphaned worktrees
- **Misunderstood sessions.spawn vs sessions.create**:
  - `spawn` = create child subsession (for research/analysis)
  - `create` = create new independent session (for coding work)
- **Forgot isolation principle**: Coding work needs NEW worktree + NEW session

### What I Should Have Done
```typescript
// 1. Create worktree with REQUIRED boardId
const worktree = await agor.worktrees.create({
  repoId: REPO_ID,
  worktreeName: 'fix-zone-pinning-bug',
  createBranch: true,
  boardId: MAIN_BOARD_ID, // MUST specify!
});

// 2. Create NEW session (not spawn subsession)
const session = await agor.sessions.create({
  worktreeId: worktree.worktree_id,
  agenticTool: 'claude-code',
  initialPrompt: "Fix the bug...",
});
```

### Lessons Learned
1. **Coding = Isolation**: Any coding work needs its own worktree + session
2. **Always specify boardId**: Prevents orphaned worktrees that aren't visible
3. **Spawn vs Create**:
   - Spawn = child subsession for research/parallel work
   - Create = new independent session for coding
4. **Check the pattern**: Don't assume "you know the drill" - different tasks need different patterns

### Actions Taken
- ✅ Updated CLAUDE.md with critical section on coding workflow
- ⏳ Need to propose making boardId required in worktrees_create
- ⏳ Need to review MCP tool docs for clarity

## Improvement Proposals

### 1. Make boardId Required in worktrees_create
**Why:** Prevents orphaned worktrees that don't show up on any board
**Change:** Make `boardId` a required parameter (or auto-default to user's main board)
**Impact:** Low - most use cases should specify a board anyway

### 2. Improve MCP Tool Documentation
**Current issues:**
- Not clear when to use spawn vs create for sessions
- Optional parameters don't explain consequences (like missing boardId)

**Proposed improvements:**
- Add usage examples to tool descriptions
- Clarify spawn (subsession) vs create (new session)
- Document best practices inline
- Add warnings about optional parameters with significant impact

### 3. Consider Default Board Behavior
**Option A:** Require boardId (fail if not specified)
**Option B:** Default to user's main board (or first board)
**Option C:** Create without board but log warning

My preference: **Option A** (explicit is better than implicit)
